FaradoScope
---

**FaradoScope** - это инструмент, объединяющий в себе четыре инструментария: TimeCalculator, GanttUi и Checker, AllIssues. Программа работает на основе данных, получаемых из загруженной БД[^1]. Инструмент анализирует данные по тем задачам, которые указал пользователь, после чего представляет проанализированные данные пользователю.

# Настройка конфига (config.json)

1) **«global» -> «port»**. В случае надобности, в данном поле можно указать порт, на котором будет работать инструментарий.
> **Примечание**
>
> В случае, если порт не указан, либо указанный порт занят, инструментарий автоматически найдёт свободный порт.
2) **«global» -> «database»**. В случае, если вас не устраивает автоматический поиск БД[^1] (см. «Запуск»), в данном поле можно указать полный путь к той БД[^1], которая вам требуется.
3) **«time_calculator» -> «pause_parameter»**. В данном поле требуется указать параметр паузы для TimeCalculator (см. «TimeCalculator» -> «Пауза»)
4) **«time_calculator» -> «csv_create»**. В данном поле требуется указать, нужно ли создать csv-файл на основе таблицы инструмента TimeCalculator.
5) **«checker» -> «csv_create»**. В данном поле требуется указать, нужно ли создать csv-файл на основе таблицы инструмента Checker.
> **Примечание**
>
> Оба csv-файла создаются в папке «/download_csv», которая находится в корневой директории инструментария («*/FaradoScope»). Файлы имеют наименования вида «<название инструмента> (<дата создания>)».

# Запуск

### Запуск на своём ПК

1) Скопируйте файл с БД [^1] в папку «database» (/FaradoScope/database).
    + Если вас не устраивает способ автоматического поиска файла БД[^1] в папке «database», укажите полный путь к файлу в config.json.
2) Настройте конфиг (см. «Настройка конфига (config.json)»).
3) Откройте командную строку и перейдите в корневую директорию инструментария (**«cd <путь к директории>»**).
4) Установите все необходимые библиотеки (**«pip install -r requirements.txt»**). 
5) Запустите файл main.py (**«python3 main.py»/«python main.py»/«pip main.py»**).
> **Примечание**
>
> В случае, если произошла какая-то ошибка (например, вы не скопировали файл с БД[^1] в папку «database» и не указали путь к нему в конфиге), в командной строке будет оповещение об ошибке. В таком случае, вам необходимо исправить ошибку и запустить файл main.py заново.

### Развёртывание приложения при помощи «Docker»

1) Установите «Docker» (**«sudo apt install docker»**).
2) Смонтируйте образ «farado_scope» с GitLab на свой ПК (**«sudo docker pull <название образа>»**).
3) Создайте из образа контейнер (**«sudo docker run --name farado_scope -it -d -p 5050:5000 -v <путь>:/app/download_csv <название образа>»**).
> **Примечание**
>
> Путь - полный путь к той директории, в которую вы хотите смонтировать папку, содержащую csv-файлы.
>
> Чтобы посмотреть название образа, введите в консоли **«sudo docker images»**.
4) Скопируйте файл с БД [^1] в папку для хранения баз данных Docker'a:
    - Перейдите в каталог, где хранится БД [^1]
    - Введите в консоли **«sudo docker cp <название БД> farado_scope:/app/database/»**
5) Зайдите в контейнер (**«sudo docker exec -it farado_scope bash»**)
6) Запустите утилиту (**«python3 main.py»** - данная команда прописывается внутри контейнера)
7) Утилита доступна по адресу localhost:5050

# Руководство пользователя

1) Укажите, нужна ли синхронизация с локальным хранилищем аналитиков (см. «Checker» -> «Синхронизация»): «y» - нужна, «n» - не нужна.
    + В случае, если вы указали «y» и при этом вы используете Linux в качестве ОС, вам нужно будет дополнительно авторизоваться на локальном сервере. В случае, если вы используете Windows, авторизация не потребуется.
2) Перейдите по ссылке, которая будет выведена в командной строке (Ctrl + ЛКМ).
3) Выберите принцип, по которому будет задан список задач, после чего нажмите «Далее».
> **Принципы**
>
> 1) «Проект-версия» - список задач задается на основе указанного проекта и версии.
> 2) «Промежуток» - список задач задается на основе промежутка с указанием конца и начала.
> 3) «Список задач» - список задач задается на основе идентификаторов задач, написанных в одну строку через пробел.
4) Отключите блокировку всплывающих окон в браузере.
5) Выберите нужные вам инструменты, после чего нажмите «Открыть страницы».
    + При выборе инструмента GanttUI, вам нужно будет указать дополнительные данные для инструментария (см. «GanttUI»).

# TimeCalculator

Это инструмент, составляющий таблицу на основе БД[^1]. Программа извлекает необходимые данные и формирует структурированную таблицу для последующего анализа.
Таблица содержит в себе следующие столбцы:
- Номер задачи;
- Название задачи; 
- Источник;
- Статус (текущий статус задачи);
- SA (оценка исследования);
- DI (оценка макетирования);
- ALG (оценка разработки алгоритмов);
- WEB (оценка веб-разработки);
- SYS (оценка системной разработки);
- TEST (оценка тестирования);
- Сумма (сумма оценок);
- Пауза (время, которое задача находилась в паузе + в скобках кол-во переходов задачи в состояние паузы);
- Факт (фактическое время выполнения задачи).

### Важные моменты

- Время в таблице указано в днях.
- При подсчете учитываются выходные дни.
>**Примечание**
>
>Если задача была в работе или в паузе в выходной день (сб или вс), этот день при подсчёте учтён не будет.

### Пауза

- Рабочее состояние — момент времени, когда задача находится в состоянии, вес которого принадлежит промежутку от 0 до 100 (не включительно).
- Нерабочее состояние — момент времени, когда задача находится в состоянии, вес которого равен 0 или 100.
>**Примечание**
>
>Вес состояния — цифра от 0 до 100 (включительно), указывающая на то, на сколько процентов задача выполнена, когда находится в данном состоянии.

Паузой считается тот момент времени, когда базовый запрос находится в рабочем состоянии, а все его дочерние запросы находятся в нерабочем состоянии. Промежуток, во время которого задача находилась в паузе, меньший одного дня, но больший параметра паузы, считается за один день. Промежуток, меньший дня и меньший параметра паузы, при подсчёте учтён не будет. По умолчанию параметр паузы равен 86399 секундам (23 часа 59 минут 59 секунд).

###### Пример
Есть базовый запрос, который находился в паузе четыре раза:
1) 3 дня и 2 часа;
2) 3 дня и 6 часов;
3) 3 часа;
4) 7 часов.
    
Дан параметр паузы, равный 18000 секундам (5 часов). При таком параметре паузы первый промежуток будет посчитан за 3 дня; второй — 
за 4 дня; третий — при подсчёте учтён не будет; четвёртый — будет посчитан за один день.

### Фактическое время выполнения (факт)

Фактическое время выполнения определяется как сумма времени выполнения всех дочерних запросов. Промежутки времени, в течение которых выполнялись дочерние задачи, суммируются в секундах, после чего делятся на 86400 (кол-во секунд в дне) с округлением в большую сторону. 
В случае, если у какого-либо дочернего запроса есть свои дочерние запросы, его время выполнения вычисляется по вышеописанной схеме.

###### Пример

Дана [схема](https://imgur.com/a/nhWtwDJ), на которой показан базовый запрос Issue и два его дочерних запроса: Kid1 и Kid2. В свою очередь, Kid1 имеет свои дочерние запросы: Kid3 и Kid4. Тогда формула для вычисления фактического времени выполнения Issue будет следующая:

**T<sub>issue</sub> = t<sub>kid1</sub> + t<sub>kid2</sub> = (t<sub>kid3</sub> + t<sub>kid4</sub>) + t<sub>kid2</sub>**, где 

T<sub>issue</sub> — фактическое время выполнения базового запроса; 

t<sub>kid1</sub> — время выполнения Kid1; 

t<sub>kid2</sub> — время выполнения Kid2; 

t<sub>kid3</sub> — время выполнения Kid3; 

t<sub>kid4</sub> — время выполнения Kid4

### Итог 

В последней строке таблицы находится общий итог, содержащий в себе следующую информацию:
- В столбце "Статус" — кол-во базовых запросов, существующих в указанном проекте и версии.
- В столбце "DI" — сумма оценки макетирования всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "SA" — сумма оценки исследования всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "ALG" — сумма оценки разработки алгоритмов всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "WEB" — сумма оценки веб-разработки всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "SYS" — сумма оценки системной разработки всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "TEST" — сумма оценки тестирования всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "Сумма" — сумма всех оценок всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "Пауза" — сумма времени пауз, а также кол-во переходов в состояние паузы всех базовых запросов, существующих в указанном проекте и версии.
- В столбце "Факт" — сумма времени фактического выполнения всех базовых запросов, существующих в указанном проекте и версии.

# GanttUI

Это инструмент, составляющий диаграмму Гантта на основе БД[^1]. Инструмент извлекает необходимые данные и формирует диаграмму Гантта для последующего анализа.

При запуске данного инструмента, вам дополнительно требуется указать количество ресурсов (см. «Страница для ввода количества ресурсов (/ganttui/resources)») и выходные дни (см. «Страницы для ввода нерабочих дней (/ganttui/resources/holidays)»).

После обработки данных, перед вами будут отображены две вкладки - страница не отображенных ресурсов и сама диаграмма.

### Страница для ввода количества ресурсов (/resources)

На странице для ввода количества ресурсов находится шесть полей для ввода количества каждого типа ресурсов: SA, DI, ALG, SYS, WEB, TEST, а также поле для выбора даты начала из календаря.
>**Определения**
>
>SA — ресурс «Аналитик».
>
>DI — ресурс «Дизайнер».
>
>ALG — ресурс «Алгоритмист».
>
>SYS — ресурс «Системный разработчик».
>
>WEB — ресурс «Веб-разработчик».
>
>TEST — ресурс «Тестировщик».
>
>Дата начала — дата, являющаяся начальной для построения диаграммы.

### Страница для ввода нерабочих дней (/resources/holidays)

На странице для ввода нерабочих дней пользователь может задать для каждого ресурса неограниченное количество нерабочих дней. При нажатии на кнопку «Добавить ресурс» на странице появляется три поля, находящиеся в одной строке. Первое поле является выпадающим списком, из которого следует выбрать ресурс. Второе поле является календарём, из которого следует выбрать начальную дату промежутка, во время которого ресурс находится в нерабочем состоянии. Третье поле также является календарём, из которого следует выбрать конечную дату промежутка, во время которого ресурс находился в нерабочем состоянии. В случае, если нерабочих промежутков нет, не следует добавлять поля, требуется просто нажать кнопку «Далее».

### Страница неотображенных ресурсов  (/unaccounted)

На странице неотображённых ресурсов отображена таблица, содержащая два столбца: "Название задачи" и "Причина". Столбец "Название задачи" содержит в себе идентефикаторы и названия неотображённых на диаграмме задач. Столбец "Причина" содержит в себе причину, по которой задача не была отображена на диаграмме. 
> **Возможные причины**
>
> Несуществующая задача - данная причина означает, что задача с таким идентефикатором не существует.
>
> Нет оценки - данная причина означает, что данная задача не имеет оценки ни по одному ресурсу.
>
> Несоответствующий статус - данная причина означает, что задача не находится в одном из четырех статусов: «Тестирование», «Разработка», «Исследование» или «Открыто».

### Диаграмма Гантта

###### Исходные данные

Исходные данные, необходимые для построения диаграммы, получаемые из БД[^1] помечены зелёным квадратом (🟩), получаемые от пользователя - красным (🟥).

Исходными данными для построения диаграммы Гантта являются:

1) Список базовых запросов. 🟥
2) Информация по базовым запросам (идентефикатор запроса, название и т. п.). 🟩
3) Значения атрибутов оценки требуемых ресурсов по базовым запросам. 🟩
4) Начальная дата для построения диаграммы. 🟥
5) Доступные типы и кол-во ресурсов. 🟥
6) Интервалы нерабочего времени для ресурсов. 🟥

###### Принцип построения

Диаграмма строится по следующему принципу:

1) Построение происходит таким образом, что срок окончания работ является наиближайшим к дате начала работ.
2) По оси x располагаются дни, по оси y - ресурсы.
3) Ресурсы отсортированы в последовательности SA -> DI -> ALG -> SYS -> WEB -> TEST (сверху вниз).
4) В диаграмме не учитываются оценки по тем ресурсам, которые не соответствуют статусу базового запроса. Т. е. для статуса «Тестирование» учитывается только оценка TEST, но не учитываются оценки SA, DI, ALG, SYS, WEB; для статуса «Разработка» учитывается оценка ALG, SYS, WEB, TEST, но не учитывается оценка SA и DI.
5) Близость расположения элемента визуализации к дате начала работ определяется весом статуса базового запроса. Т. е. задача, находящаяся в статусе «Тестирование», будет расположена ближе, чем задача, находящаяся в статусе «Разработка».
6) В диаграмме учитываются только задачи, находящиеся в четырёх статусах: «Тестирование», «Разработка», «Исследование», «Открыто», имеющие оценку хотя бы по одному ресурсу и являющиеся базовым запросом. Остальные задачи выводятся в виде таблицы с двумя столбцами: название задачи и причина, по которой задача не была учтена в диаграмме.
7) Каждая отдельная задача имеет свою индикацию (цвет).
8) Нерабочие дни являются отдельной задачей и помечены на диаграмме белым цветом.
9) В диаграмме учитываются выходные дни. Т. е. каждый день, являющийся восресением или субботой, является нерабочим, но таковым не помечен (п. 8).
10) На колорбаре отображается задача «(пустая задача)». Это системная задача, не влияющая на построение диаграммы. Не следует никак взаимодействовать с ней.
> Колорбар - интерактивное поле справа от диаграммы, на нём отображаются все задачи, присутствующие на диаграмме.

###### Элементы управления диаграммой

Вверху страницы справа находятся элементы управления диаграммой. При наведении на них появляются подписи. Существуют следующие элементы управления:
1) **Download plot as png** - сохранить диаграмму в виде png.
2) **Zoom** - инструмент, позволяющий увеличивать масштаб диаграммы. После нажатия на него, следует выделить на диаграмме ту часть, которую требуется рассмотреть более детально.
3) **Pan** - инструмент, позволяющий передвигать содержимое диаграммы. После нажатия на него, следует навести курсор на саму диаграмму и зажать левую кнопку мыши.
4) **Box select** и **Lasso select** - инструменты, позволяющие выделять элементы диаграммы.
5) **Zoom in** - инструмент, позволяющий увеличивать масштаб диаграммы.
6) **Zoom out** - инструмент, позволяющий уменьшать масштаб диаграммы.
7) **Autoscale** - инструмент, автоматически масштабирующий диаграмму.
8) **Reset axes** - инструмент, позволяющий сбросить все настройки масштабирования и вернуться к дефолтным настройкам.

Справа от диаграммы расположен колорбар, на котором отображен список всех задач с их идентификаторами и наименованиями, а также их цветовая индикация. При нажатии на какую-либо задачу, она станет скрытой. При повторном нажатии на эту задачу, она снова отобразится на диаграмме.

# Checker

Это инструмент, составляющий таблицу на основе БД [^1]. Инструмент извлекает необходимые данные, производит их анализ и демонстрирует пользователю в виде удобной таблицы.

###### Описание столбцов

+ **Название задачи**. Данный столбец содержит в себе следующую информацию: идентификатор задачи и её название. Данная информация находится в таблице в следующем виде: «#<идентификатор задачи> <название задачи>».
+ **Папка задачи**. Данный столбец содержит в себе информацию о том, существует ли папка с данной задачей в локальном хранилище аналитиков. Папка существует = True, не существует = False.
+ **Требования**. Данный столбец содержит информацию о том, присутствует ли дочерний запрос типа «Исследование — Задача (SA)» (запрос должен находится в статусе с весом, равным 100). Запрос присутствует = True, не присутствует = False.
+ **Оценка**. Данный столбец содержит информацию о том, присутствует ли оценка хотя бы в одном соответствующем атрибуте базового запроса. Оценка присутствует = True, не присутствует = False.
+ **Макет**. Данный столбец содержит информацию о том, присутствует ли дочерний запрос типа «Исследование (дизайн) — Макет». Дочерний запрос присутствует = True, отсутствует = False.
+ **Исполнители**. Данный столбец содержит информацию о том, заполнены ли все поля «Исполнитель» у дочерних запросов. Если у всех дочерних задач заполнены = True, если не заполнены хотя бы у одного = False.
+ **Отделы разработки**. Данный столбец содержит информацию о том, указаны ли отделы разработки в базовом запросе. Если указаны = True, не указаны = False.
+ **Статус**. В данном столбце находится результат проверки на наличие следующих ситуаций: базовый запрос находится в невесомом статусе (вес статуса равен 0 или 100) при наличии подзадач с весомым статусом (вес которого принадлежит промежутку (0; 100)); базовый запрос находится в весомом статусе (вес статуса принадлежит промежутку (0; 100)) при наличии всех подзадач в невесомом статусе (вес которых равен 0 или 100). Если таких ситуаций не существует = True, существует = False.
+ **Источник**. Данный столбец содержит информацию о том, заполнены ли поля «Контакт», «Проект», «Партнер». Все перечисленные столбцы заполнены = True, не заполнен хотя бы один = False. 
+ **Соответствие**. Данный столбец содержит информацию о том, совпадают ли версии базового запроса и всех его дочерних задач. Совпадают = True, не совпадают = False.
+ **Тестирование**. Данный столбец содержит информацию о том, присутствует ли дочерний запрос типа «Контроль качества — Тестирование». Присутствует = True, не присутствует = False.
+ **Воспроизведение**. Данный столбец содержит информацию о том, присутствует ли дочерний запрос типа «Контроль качества: Задача (QA)». Присутствует = True, не присутствует = False.
+ **Документация**. Данный столбец содержит информацию о том, присутствует ли дочерний запрос типа «Контроль качества: Документация (QA)». Присутствует = True, не присутствует = False.
+ **Исправление**. Данный столбец содержит информацию о том, сколько существует дочерних запросов типа «Разработка — Исправление» внутри базового запроса. В случае, если количество таких задач > 0, в столбце находится число - количество таких запросов. В случае, если количество таких задач = 0, в столбце находится False.
+ **Наличие БЗ**. Данный столбец содержит информацию о том, есть ли в дочерних запросах базового запроса другие базовые запросы. Если нету = True, если есть = False.
+ **Кол-во подзадач**. Данный столбец содержит информацию о том, сколько дочерних запросов содержит в себе базовый запрос. В случае, если количество подзадач > 0, столбец содержит в себе целое число - количество подзадач. В случае, если количество подзадач = 0, столбец содержит в себе False.

# AllIssues

Данный инструмент позволяет сгенерировать таблицу, состоящую из неопределённого количества столбцов (их количество зависит от количества возможных типов полей). В столбцах находится следующая информация:
1) идентификатор задачи;
2) название задачи;
3) актуальный статус задачи;
4) наименование проекта;
5) наименование версии;
6) дата и время создания задачи;
7) фамилия и имя создателя запроса;
8) дата и время последнего изменения задачи;
9) фамилия и имя того, кто сделал последние изменение;
Далее находится неопределенное количество столбцов, где каждый столбец - существующее в FARADO поле. Если данного поля у задачи не существует, ячейка остается пустой.


[^1]: БД - база данных FARADO.

